#!/bin/bash
cd /tmp/rom

# ccache 
export USE_CCACHE=1
export CCACHE_DIR="/tmp/ccache"
export CCACHE_EXEC="$(which ccache)"
ccache -M 20G
ccache -o compression=true
ccache -z

# Normal build steps
. build/envsetup.sh
lunch aosp_mido-user

# Let's compile by parts! Coz of ram issue!
make api-stubs-docs || echo no problem
make system-api-stubs-docs || echo no problem
make test-api-stubs-docs || echo no problem

make aex -j8

# upload
mkdir -p ~/.config/rclone
echo "$rclone_config" >~/.config/rclone/rclone.conf
rclone copy out/target/product/mido/*zip GDUP:ROM/ZIP -P
